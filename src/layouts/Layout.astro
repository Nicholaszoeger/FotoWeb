---
interface Props {
	title?: string;
}

const { title = "Bitt Films" } = Astro.props;
---

<!DOCTYPE html>
<html lang="es">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{title}</title>
	
	<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
	<slot />
	
	<script is:inline>
		// El código se ejecuta inmediatamente al cargar el cuerpo de la página
		if (window.netlifyIdentity) {
			
			// Inicializar el widget
			window.netlifyIdentity.init(); // <--- CRUCIAL: Inicializar el widget primero.

			// A. Manejo de Invitaciones (Basado en la URL)
			// La presencia del token (#invite_token=...) debe abrir el formulario
			if (window.location.hash.includes('invite_token')) {
				// Abrimos el formulario inmediatamente.
				// El widget automáticamente detectará el token y lo procesará.
				window.netlifyIdentity.on('init', () => {
					window.netlifyIdentity.open();
				});
			}

			// B. Redirección después de Login/Signup (Unificado)
			// Se ejecuta después de iniciar sesión O después de crear la cuenta
			window.netlifyIdentity.on("login", () => {
				document.location.href = "/admin/";
			});
			window.netlifyIdentity.on("signup", () => {
				document.location.href = "/admin/";
			});
		}
	</script>
</body>
</html>