---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Aceptar invitación - Bitt Films">
  <div class="invite-page">
    <div class="container">
      <h1>Configurar tu cuenta</h1>
      <p>Bienvenido al panel de administración de Bitt Films</p>
      <div id="invite-message">
        <p>Procesando tu invitación...</p>
      </div>
    </div>
  </div>
</Layout>

<script>
  // Abrir automáticamente el widget si hay token de invitación
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on("init", user => {
      if (user) {
        // Ya está autenticado, ir al admin
        window.location.href = "/admin/";
      } else if (window.location.hash.includes('invite_token')) {
        // Hay token, abrir modal
        setTimeout(() => {
          window.netlifyIdentity.open();
        }, 500);
      } else {
        // No hay token, mostrar error
        const msg = document.getElementById('invite-message');
        if (msg) {
          msg.innerHTML = '<p style="color: red;">No se encontró invitación válida</p>';
        }
      }
    });
    
    window.netlifyIdentity.on("signup", () => {
      window.location.href = "/admin/";
    });
  }
</script>

<style>
  .invite-page {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    font-family: system-ui, -apple-system, sans-serif;
  }
  
  .container {
    background: white;
    padding: 3rem;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    text-align: center;
    max-width: 500px;
    width: 90%;
  }
  
  h1 {
    font-size: 2rem;
    margin-bottom: 1rem;
    color: #333;
  }
  
  p {
    color: #666;
    font-size: 1.1rem;
    margin-bottom: 1.5rem;
  }
  
  #invite-message {
    margin-top: 2rem;
  }
</style>